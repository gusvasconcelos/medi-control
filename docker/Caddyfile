{
	admin off
	frankenphp
	order php_server before file_server
	# Disable automatic HTTPS when running behind a reverse proxy
	{$CADDY_AUTO_HTTPS:auto_https off}
}

:{$PORT:8000} {
	root * /app/public

	# Enable PHP handler
	php_server

	# Enable compression
	encode gzip zstd

	# Security headers
	header {
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	# Cache static assets (build folder contains versioned files)
	@static {
		path /build/* /favicon.ico /robots.txt
	}
	header @static {
		Cache-Control "public, max-age=31536000, immutable"
	}

	# Cache images and fonts
	@assets {
		path *.css *.js *.png *.jpg *.jpeg *.gif *.svg *.ico *.woff *.woff2 *.ttf *.eot
		not path /build/*
	}
	header @assets {
		Cache-Control "public, max-age=604800"
	}

	# Static files
	file_server

	# Logs
	log {
		output stdout
		format json
		level INFO
	}
}
